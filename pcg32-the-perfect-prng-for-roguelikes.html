<!DOCTYPE html><html lang=en> <head><title>Steve Landey –<span class=caps> PCG32</span>: The Perfect<span class=caps> PRNG</span> for&nbsp;Roguelikes</title><meta name=viewport content="width=device-width"><meta charset=UTF-8><meta charset=utf-8><link href=http://steveasleep.com/feeds/all.atom.xml type=application/atom+xml rel=alternate title="Steve Landey Full Atom Feed"><link href=http://steveasleep.com/feeds/all.rss.xml type=application/rss+xml rel=alternate title="Steve Landey Full RSS Feed"><script src=http://steveasleep.com/js/hyphenate.js defer></script><script src=http://steveasleep.com/js/main.js defer></script><style type=text/css>﻿html,body,body div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,samp,small,strong,sub,sup,var,b,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,figure,footer,header,menu,nav,section,time,mark,audio,video,details,summary{margin:0;padding:0;border:0;font-size:100%;vertical-align:baseline;background:transparent}article,aside,figure,footer,header,nav,section,details,summary{display:block}img,object,embed{max-width:100%}html{overflow-y:scroll}ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}a{margin:0;padding:0;font-size:100%;vertical-align:baseline;background:transparent}del{text-decoration:line-through}abbr[title],dfn[title]{border-bottom:1px dotted #000;cursor:help}table{border-collapse:collapse;border-spacing:0}th{font-weight:bold;vertical-align:bottom}td{font-weight:normal;vertical-align:top}hr{display:block;height:1px;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0}input,select{vertical-align:middle}pre{white-space:pre;word-wrap:break-word}input[type="radio"]{vertical-align:text-bottom}input[type="checkbox"]{vertical-align:bottom}.ie7 input[type="checkbox"]{vertical-align:baseline}.ie6 input{vertical-align:text-bottom}select,input,textarea{font:99% sans-serif}table{font-size:inherit;font:100%}small{font-size:85%}strong{font-weight:bold}td,td img{vertical-align:top}sub,sup{font-size:75%;line-height:0;position:relative}sup{top:-0.5em}sub{bottom:-0.25em}pre,code,kbd,samp{font-family:monospace, sans-serif}.clickable,label,input[type=button],input[type=submit],input[type=file],button{cursor:pointer}button,input,select,textarea{margin:0}button{width:auto;overflow:visible}.ie7 img{-ms-interpolation-mode:bicubic}.ie6 html{filter:expression(document.execCommand("BackgroundImageCache", false, true))}.clearfix:before,.clearfix:after{content:"\0020";display:block;height:0;overflow:hidden}.clearfix:after{clear:both}.clearfix{zoom:1}.hll{background-color:#ffffcc}.c{color:#999988;font-style:italic}.err{color:#a61717;background-color:#e3d2d2}.k{color:#000000;font-weight:bold}.o{color:#000000;font-weight:bold}.cm{color:#999988;font-style:italic}.cp{color:#999999;font-weight:bold;font-style:italic}.c1{color:#999988;font-style:italic}.cs{color:#999999;font-weight:bold;font-style:italic}.gd{color:#000000;background-color:#ffdddd}.ge{color:#000000;font-style:italic}.gr{color:#aa0000}.gh{color:#999999}.gi{color:#000000;background-color:#ddffdd}.go{color:#888888}.gp{color:#555555}.gs{font-weight:bold}.gu{color:#aaaaaa}.gt{color:#aa0000}.kc{color:#000000;font-weight:bold}.kd{color:#000000;font-weight:bold}.kn{color:#000000;font-weight:bold}.kp{color:#000000;font-weight:bold}.kr{color:#000000;font-weight:bold}.kt{color:#445588;font-weight:bold}.m{color:#009999}.s{color:#d01040}.na{color:#008080}.nb{color:#0086B3}.nc{color:#445588;font-weight:bold}.no{color:#008080}.nd{color:#3c5d5d;font-weight:bold}.ni{color:#800080}.ne{color:#990000;font-weight:bold}.nf{color:#990000;font-weight:bold}.nl{color:#990000;font-weight:bold}.nn{color:#555555}.nt{color:#000080}.nv{color:#008080}.ow{color:#000000;font-weight:bold}.w{color:#bbbbbb}.mf{color:#009999}.mh{color:#009999}.mi{color:#009999}.mo{color:#009999}.sb{color:#d01040}.sc{color:#d01040}.sd{color:#d01040}.s2{color:#d01040}.se{color:#d01040}.sh{color:#d01040}.si{color:#d01040}.sx{color:#d01040}.sr{color:#009926}.s1{color:#d01040}.ss{color:#990073}.bp{color:#999999}.vc{color:#008080}.vg{color:#008080}.vi{color:#008080}.il{color:#009999}html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}canvas{display:none}html{line-height:160%;font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-color:#fafafa;color:#282828}a,a:visited,a:active{color:#3c3c50}a:hover{color:#5050fa}h1,h2,h3,h4,h5,h6{font-family:"Helvetica Neue", "HelveticaNeue", Helvetica, Arial, "Lucida Grande", sans-serif;font-weight:normal;margin-top:1em;margin-bottom:.75em;line-height:1.5em}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{color:#3c3c50;text-decoration:none}h1 a:visited,h1 a:active,h1 a:hover,h2 a:visited,h2 a:active,h2 a:hover,h3 a:visited,h3 a:active,h3 a:hover,h4 a:visited,h4 a:active,h4 a:hover,h5 a:visited,h5 a:active,h5 a:hover,h6 a:visited,h6 a:active,h6 a:hover{color:#3c3c50;text-decoration:underline}h1,h2{font-size:1.5rem}h3,h4{font-size:1.2rem}h5,h6{font-size:1.0rem}h1,h3,h5{font-weight:bold}h2,h4,h6{font-weight:normal}p,ul,ol,pre{margin-bottom:1.5rem}pre,code,kbd,samp{font-family:Menlo, Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, monospace;background-color:#fff}code{color:#505050}pre{font-size:0.8rem;line-height:1rem;margin-left:-.5rem;margin-right:-.5rem;padding:.5rem .5rem}article ul{list-style-type:disc}article li{padding-left:0.5rem;margin-left:1rem;margin-bottom:.5rem}article li>ul,article li>ol{margin-top:.5rem}article iframe,table{margin-bottom:1.5rem}table th{text-align:left;font-weight:normal;padding-right:2rem;border-bottom:1px solid #dbdbdb}table td{padding-right:2rem}p{text-rendering:optimizeLegibility}article blockquote{margin-left:2em;font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;font-size:.9rem;line-height:1.2rem}iframe{max-width:100%}.left{float:left;padding-right:1rem}.right{float:right;padding-left:1rem}.center{display:block;margin:auto}a.implied-link{text-decoration:none}a.implied-link:hover{text-decoration:underline}.entry-content a{color:#3c3c8c}.entry-content a:hover{color:#5050fa}#pagecontainer{width:100%;max-width:50rem;max-width:calc($pageWidth - 2rem);margin-left:auto;margin-right:auto;padding:0rem 1rem 1rem 1rem}nav#menu,section#content,footer#pagefooter{width:100%}#sidebar{padding-left:1rem}#sidebar h3{font-size:1em}header#banner{box-sizing:border-box;line-height:2.3625rem;padding:0.75em 0}header#banner h1{font-size:1.75rem;font-family:"Helvetica Neue", "HelveticaNeue", Helvetica, Arial, "Lucida Grande", sans-serif;margin:.75rem 0;display:inline-block}header#banner .header-links{line-height:2.3625rem;margin-top:.75rem}header#banner .header-links a{margin-right:0.5rem}@media (min-width: 50rem){header#banner .header-links{display:block;float:right}}@media (min-width: 78rem){#layoutcontainer{display:flex;flex-direction:row-reverse;justify-content:stretch;align-items:stretch}#menu{display:none}#sidebar{flex-grow:0;flex-shrink:0;width:12rem;padding-right:1rem}#sidebar h1:first-child,#sidebar h2:first-child,#sidebar h3:first-child{margin-top:0}}#menu{margin-bottom:2rem}#menu ul:after{clear:both;content:".";display:block;height:0;visibility:hidden}#menu li a,#menu li strong{margin-right:0.5rem}article.home-page ul.article-summary-list{margin:0;padding:0}article.home-page ul.article-summary-list>li{list-style-type:none;margin:0;padding:0;padding-top:2rem;margin-bottom:2rem;border-top:1px solid #dbdbdb}article.home-page ul.article-summary-list>li:first-child{border-top:none;padding-top:0}article.home-page ul.article-summary-list>li:first-child .entry-title{margin-top:0}article.home-page ul.article-summary-list>li .read-more{text-align:right}#pagefooter{margin-top:4rem;margin-bottom:3rem;padding-top:1rem}#pagefooter .social-links{text-align:right;font-size:0.8rem;float:right}.article-header{margin-bottom:1rem}.article-header:after{clear:both;content:".";display:block;height:0;visibility:hidden}.article-header .entry-title{margin-top:0;margin-bottom:1rem}.article-header.article-header__index h1{font-size:3rem;font-weight:bold;margin:0}.article-header .post-info time{display:block;font-family:"Helvetica Neue", "HelveticaNeue", Helvetica, Arial, "Lucida Grande", sans-serif;font-weight:normal}.promo .promo-group{margin-bottom:2rem}.promo .promo-group h2{width:100%;margin:0 0 1rem 0;padding:0}.promo .promo-group .promo-group__outerlist{margin:0;padding:0}.promo .promo-group .promo-group__outerlist>li{list-style-type:none}.promo .promo-group .promo-item__logo{display:block;margin:0 auto 1rem auto;max-width:64px;max-height:64px;border-radius:5px}.promo .promo-group__opensource .promo-item{padding:0;margin:0}.promo .promo-group__writing .promo-item{padding:0;margin:0}.promo .promo-group__writing .promo-item__title{font-size:1.2rem}.promo .promo-group__writing .promo-item__blog{color:#6749e3}.promo .promo-group__writing .promo-item__twitter{color:#1da1f2}.promo .promo-group__writing .promo-item__oldblog,.promo .promo-group__writing .promo-item__résumé{color:#8e8e8e}.promo .promo-group__games .promo-group__outerlist,.promo .promo-group__apps .promo-group__outerlist{display:flex;flex-flow:row wrap;justify-content:flex-start;margin-right:-2rem}@media (max-width: 50rem){.promo .promo-group__games .promo-group__outerlist,.promo .promo-group__apps .promo-group__outerlist{justify-content:space-around}}.promo .promo-group__games .promo-item,.promo .promo-group__apps .promo-item{flex-grow:0;margin:0 2rem 1rem 0;padding:0;text-align:center}@media (max-width: 50rem){.promo .promo-group__games .promo-item,.promo .promo-group__apps .promo-item{flex-grow:1;flex-basis:40%}}.resume-image{image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges;transform:translateY(8px)}

/*# sourceMappingURL=style.css.map */</style></head> <body> <div id=layoutcontainer> <div id=pagecontainer> <header id=banner class=body> <h1> <a href=http://steveasleep.com> Steve Landey </a> </h1> <div class=header-links> <a href=mailto:randos@steve.steveasleep.com>Email</a> <a href=https://github.com/irskep>GitHub</a> <a href=https://www.youtube.com/channel/UC0lx9IhbHiM5XTcdISqttWQ>YouTube</a> <a href=https://slamjamsen.bandcamp.com>Bandcamp</a> <a href=https://irskep.itch.io>itch.io</a> </div> </header> <section id=content class=body><article class=article> <header class=article-header> <h1 class=entry-title> <a href=http://steveasleep.com/pcg32-the-perfect-prng-for-roguelikes.html rel=bookmark title="Permalink to PCG32: The Perfect PRNG for Roguelikes"> <span class=caps>PCG32</span>: The Perfect <span class=caps>PRNG</span> for&nbsp;Roguelikes </a> </h1> <div class=post-info> <time class=published datetime=2018-03-14T00:00:00-07:00> March 14, 2018 </time> </div> </header> <div class="entry-content hyphenate"><p>Roguelikes are games that, among other things, have a lot of procedurally generated content. To generate content, we need random numbers. And to get random numbers, we need a <strong>pseudo-random number generator</strong>.</p> <p>Not only do we want random numbers, but we want <em>predictable</em> random numbers! We want players to be able to share seeds and see who does better in the same situation, while also giving people a completely fresh experience every time they&nbsp;play.</p> <p>We can&#8217;t just create a <span class=caps>PRNG</span> with a seed and be done. If we use the same <span class=caps>PRNG</span> for both level generation and combat, for example, then our second level might change based on how many times the player got into a&nbsp;fight!</p> <p>So we need to be clever about how we create and store our PRNGs, to ensure that the procedurally generated maps are not affected by anything that happens during&nbsp;gameplay.</p> <p>If we use the <a href=http://www.pcg-random.org><span class=caps>PCG</span> family of PRNGs</a>, our job is a lot easier. There are many variants of <span class=caps>PCG</span>, but in this post I&#8217;ll be referring only to <span class=caps>PCG32</span>, the one that generates 32-bit unsigned integers and keeps its state as two 64-bit unsigned&nbsp;integers.</p> <p>(By the way, I used <span class=caps>PCG</span> in <a href=https://irskep.itch.io/dr-hallervorden>Dr. Hallervorden</a>, my <span class=caps>7DRL</span> entry for&nbsp;2018.)</p> <h1>What makes <span class=caps>PCG</span>&nbsp;unique?</h1> <p><span class=caps>PCG</span> has a lot going for it, and <a href=http://www.pcg-random.org>the web site does a good job of explaining the advantages</a>, but for roguelike developers, it all comes down to the <span class=caps>API</span>.</p> <p>A <span class=caps>PCG</span> instance is created with not one, but <strong>two</strong> values: the <em>seed</em>, and the <em>stream</em>. The seed matches the traditional idea of a <span class=caps>PRNG</span> seed, but the stream is something new: it lets you pick from <strong>multiple streams of random numbers</strong> generated by the same&nbsp;seed!</p> <div class=highlight><pre><span></span><span class=k>for</span> <span class=n>seed</span><span class=p>:</span> <span class=nb>UInt64</span> <span class=k>in</span> <span class=p>[</span><span class=mi>12345</span><span class=p>,</span> <span class=mi>67890</span><span class=p>]</span> <span class=p>{</span>
  <span class=bp>print</span><span class=p>(</span><span class=s>&quot;Seed:&quot;</span><span class=p>,</span> <span class=n>seed</span><span class=p>)</span>
  <span class=k>for</span> <span class=n>seq</span><span class=p>:</span> <span class=nb>UInt64</span> <span class=k>in</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=p>{</span>

    <span class=c1>// two numbers: seed and seq</span>
    <span class=kd>let</span> <span class=nv>rng</span> <span class=p>=</span> <span class=n>PCG32Generator</span><span class=p>(</span><span class=n>seed</span><span class=p>:</span> <span class=n>seed</span><span class=p>,</span> <span class=n>seq</span><span class=p>:</span> <span class=n>seq</span><span class=p>)</span>

    <span class=kd>let</span> <span class=nv>values</span> <span class=p>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>9</span><span class=p>].</span><span class=bp>map</span><span class=p>({</span><span class=kc>_</span> <span class=k>in</span> <span class=s>&quot;</span><span class=si>\(</span><span class=n>rng</span><span class=p>.</span><span class=kr>get</span><span class=si>(</span><span class=n>upperBound</span><span class=p>:</span> <span class=mi>100</span><span class=si>))</span><span class=s>&quot;</span> <span class=p>})</span>
    <span class=bp>print</span><span class=p>(</span><span class=s>&quot;Stream </span><span class=si>\(</span><span class=n>seq</span><span class=si>)</span><span class=s>:&quot;</span><span class=p>,</span> <span class=n>values</span><span class=p>.</span><span class=n>joined</span><span class=p>(</span><span class=n>separator</span><span class=p>:</span> <span class=s>&quot;, &quot;</span><span class=p>))</span>
  <span class=p>}</span>
  <span class=bp>print</span><span class=p>()</span>
<span class=p>}</span>
</pre></div> <div class=highlight><pre><span></span><span class=n>Seed</span><span class=o>:</span> <span class=mi>12345</span>
<span class=n>Stream</span> <span class=mi>0</span><span class=o>:</span> <span class=mi>9</span><span class=o>,</span> <span class=mi>26</span><span class=o>,</span> <span class=mi>14</span><span class=o>,</span> <span class=mi>74</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>82</span><span class=o>,</span> <span class=mi>86</span><span class=o>,</span> <span class=mi>75</span><span class=o>,</span> <span class=mi>82</span><span class=o>,</span> <span class=mi>92</span>
<span class=n>Stream</span> <span class=mi>1</span><span class=o>:</span> <span class=mi>24</span><span class=o>,</span> <span class=mi>4</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>76</span><span class=o>,</span> <span class=mi>54</span><span class=o>,</span> <span class=mi>90</span><span class=o>,</span> <span class=mi>40</span><span class=o>,</span> <span class=mi>98</span><span class=o>,</span> <span class=mi>15</span><span class=o>,</span> <span class=mi>34</span>
<span class=n>Stream</span> <span class=mi>2</span><span class=o>:</span> <span class=mi>60</span><span class=o>,</span> <span class=mi>17</span><span class=o>,</span> <span class=mi>46</span><span class=o>,</span> <span class=mi>15</span><span class=o>,</span> <span class=mi>6</span><span class=o>,</span> <span class=mi>30</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>68</span><span class=o>,</span> <span class=mi>29</span><span class=o>,</span> <span class=mi>91</span>

<span class=n>Seed</span><span class=o>:</span> <span class=mi>67890</span>
<span class=n>Stream</span> <span class=mi>0</span><span class=o>:</span> <span class=mi>54</span><span class=o>,</span> <span class=mi>68</span><span class=o>,</span> <span class=mi>74</span><span class=o>,</span> <span class=mi>56</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=mi>63</span><span class=o>,</span> <span class=mi>43</span><span class=o>,</span> <span class=mi>47</span><span class=o>,</span> <span class=mi>21</span><span class=o>,</span> <span class=mi>96</span>
<span class=n>Stream</span> <span class=mi>1</span><span class=o>:</span> <span class=mi>36</span><span class=o>,</span> <span class=mi>16</span><span class=o>,</span> <span class=mi>80</span><span class=o>,</span> <span class=mi>58</span><span class=o>,</span> <span class=mi>36</span><span class=o>,</span> <span class=mi>31</span><span class=o>,</span> <span class=mi>5</span><span class=o>,</span> <span class=mi>14</span><span class=o>,</span> <span class=mi>29</span><span class=o>,</span> <span class=mi>73</span>
<span class=n>Stream</span> <span class=mi>2</span><span class=o>:</span> <span class=mi>89</span><span class=o>,</span> <span class=mi>61</span><span class=o>,</span> <span class=mi>71</span><span class=o>,</span> <span class=mi>58</span><span class=o>,</span> <span class=mi>85</span><span class=o>,</span> <span class=mi>14</span><span class=o>,</span> <span class=mi>70</span><span class=o>,</span> <span class=mi>6</span><span class=o>,</span> <span class=mi>59</span><span class=o>,</span> <span class=mi>31</span>
</pre></div> <p>This means you can start your game with one seed, and then lazily create individual <span class=caps>PCG</span> instances for each level at the time you need them, without worrying that your <span class=caps>PRNG</span> state has been messed up just by playing the game. (There are other ways of making that guarantee that aren&#8217;t difficult, but this one is particularly&nbsp;convenient.)</p> <p>Once we&#8217;ve created a <span class=caps>PCG</span> instance, we only need to store two unsigned integers! Serialization&#8217;s a&nbsp;snap.</p> <p>So, to sum&nbsp;up:</p> <ul> <li>You can have multiple, uncorrelated streams of data from the same&nbsp;seed</li> <li>You only need to store 16 bytes per&nbsp;instance</li> </ul> <h1>A fun trick with&nbsp;strings</h1> <p>Imagine you have a branching level structure. You&#8217;ve got <code>normal-dungeon-1</code> through <code>normal-dungeon-30</code>, and you might branch off into <code>dwarvish-mines-1</code> somewhere between level 5 and&nbsp;15.</p> <p>Rather than deciding exactly how to branch when the game starts and generating all the level seeds in advance, you can create an object that lazily creates <span class=caps>PCG32</span> instances based on the hash value if your level <span class=caps>ID</span>&nbsp;string!</p> <div class=highlight><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PRNGStore</span><span class=p>:</span> <span class=n>Codable</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>let</span> <span class=nv>seed</span><span class=p>:</span> <span class=nb>UInt64</span>

  <span class=kd>private</span> <span class=kd>var</span> <span class=nv>rngCache</span> <span class=p>=</span> <span class=p>[</span><span class=nb>UInt64</span><span class=p>:</span> <span class=n>PCG32Generator</span><span class=p>]()</span>
  <span class=kd>private</span> <span class=kd>var</span> <span class=nv>collisionChecks</span> <span class=p>=</span> <span class=p>[</span><span class=nb>UInt64</span><span class=p>:</span> <span class=nb>String</span><span class=p>]()</span>

  <span class=kd>public</span> <span class=kd>init</span><span class=p>(</span><span class=n>seed</span><span class=p>:</span> <span class=nb>UInt64</span><span class=p>)</span> <span class=p>{</span>
    <span class=kc>self</span><span class=p>.</span><span class=n>seed</span> <span class=p>=</span> <span class=n>seed</span>
  <span class=p>}</span>

  <span class=c1>/// Lazily create a PRNG instance based on the given stream</span>
  <span class=kd>public</span> <span class=kd>func</span> <span class=nf>get</span><span class=p>(</span><span class=n>stream</span><span class=p>:</span> <span class=nb>UInt64</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=n>PCG32Generator</span> <span class=p>{</span>
    <span class=k>if</span> <span class=kd>let</span> <span class=nv>rng</span> <span class=p>=</span> <span class=n>rngCache</span><span class=p>[</span><span class=n>stream</span><span class=p>]</span> <span class=p>{</span> <span class=k>return</span> <span class=n>rng</span> <span class=p>}</span>
    <span class=kd>let</span> <span class=nv>rng</span> <span class=p>=</span> <span class=n>PCG32Generator</span><span class=p>(</span><span class=n>seed</span><span class=p>:</span> <span class=n>seed</span><span class=p>,</span> <span class=n>seq</span><span class=p>:</span> <span class=n>stream</span><span class=p>)</span>
    <span class=n>rngCache</span><span class=p>[</span><span class=n>stream</span><span class=p>]</span> <span class=p>=</span> <span class=n>rng</span>
    <span class=k>return</span> <span class=n>rng</span>
  <span class=p>}</span>

  <span class=c1>/// Lazily create a PRNG based on the given string by getting its hash value</span>
  <span class=c1>/// and handling hash collisions</span>
  <span class=kd>public</span> <span class=kd>func</span> <span class=nf>get</span><span class=p>(</span><span class=n>id</span><span class=p>:</span> <span class=nb>String</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=n>PCG32Generator</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nv>seq</span> <span class=p>=</span> <span class=nb>UInt64</span><span class=p>(</span><span class=n>bitPattern</span><span class=p>:</span> <span class=nb>Int64</span><span class=p>(</span><span class=n>id</span><span class=p>.</span><span class=n>hashValue</span><span class=p>))</span>
    <span class=k>while</span> <span class=n>collisionChecks</span><span class=p>[</span><span class=n>seq</span><span class=p>]</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=n>collisionChecks</span><span class=p>[</span><span class=n>seq</span><span class=p>]</span> <span class=o>!=</span> <span class=n>id</span> <span class=p>{</span>
      <span class=bp>print</span><span class=p>(</span><span class=s>&quot;Collision between&quot;</span><span class=p>,</span> <span class=n>id</span><span class=p>,</span> <span class=s>&quot;and&quot;</span><span class=p>,</span> <span class=n>collisionChecks</span><span class=p>[</span><span class=n>seq</span><span class=p>]</span> <span class=p>??</span> <span class=s>&quot;nil&quot;</span><span class=p>)</span>
      <span class=n>seq</span> <span class=o>+=</span> <span class=mi>1</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=n>collisionChecks</span><span class=p>[</span><span class=n>seq</span><span class=p>]</span> <span class=p>==</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=n>collisionChecks</span><span class=p>[</span><span class=n>seq</span><span class=p>]</span> <span class=p>=</span> <span class=n>id</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=kc>self</span><span class=p>.</span><span class=kr>get</span><span class=p>(</span><span class=n>stream</span><span class=p>:</span> <span class=n>seq</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=kd>public</span> <span class=kd>func</span> <span class=nf>get</span><span class=p>(</span><span class=n>stream</span><span class=p>:</span> <span class=nb>UInt64</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=n>PCG32Generator</span> <span class=p>{</span>
    <span class=k>if</span> <span class=kd>let</span> <span class=nv>rng</span> <span class=p>=</span> <span class=n>rngCache</span><span class=p>[</span><span class=n>stream</span><span class=p>]</span> <span class=p>{</span> <span class=k>return</span> <span class=n>rng</span> <span class=p>}</span>
    <span class=kd>let</span> <span class=nv>rng</span> <span class=p>=</span> <span class=n>PCG32Generator</span><span class=p>(</span><span class=n>seed</span><span class=p>:</span> <span class=n>seed</span><span class=p>,</span> <span class=n>seq</span><span class=p>:</span> <span class=n>stream</span><span class=p>)</span>
    <span class=n>rngCache</span><span class=p>[</span><span class=n>stream</span><span class=p>]</span> <span class=p>=</span> <span class=n>rng</span>
    <span class=k>return</span> <span class=n>rng</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> <p>Once you have a class like this, you never again need to think about when and how to generate <span class=caps>PRNG</span> instances, because it all just happens by magic. Using the example at the beginning of this section, you can now generate any dungeon using the <span class=caps>PRNG</span> instance at <code>prngStore[levelId]</code>, e.g. <code>prngStore["dwarvish-mines-1"]</code>.</p> <h1>Language&nbsp;support</h1> <p><span class=caps>PCG32</span> is very easy to implement, so it has broad language support, even though the algorithm was only introduced in 2014. I wrote two implementations myself: <a href=https://github.com/irskep/clubsandwich/blob/master/clubsandwich/pcg32.py>Python</a> and <a href=https://github.com/irskep/RogueKit/blob/master/Sources/RogueKit/Util/PCG32.swift>Swift</a>. You should be able to find a good implementation for your favorite language just by searching the web. And if you can&#8217;t find one, it really isn&#8217;t too hard to do! It&#8217;s just a handful of bitwise&nbsp;operations.</p></div> </article></section> </div> </div> <script type=text/javascript>

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4517625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script> </body> </html>