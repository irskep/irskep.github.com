<!DOCTYPE html>
<html lang="en">
<head>
    <title>Steve Johnson – PCG32: The Perfect PRNG for Roguelikes</title>

    <meta name="viewport" content="width=device-width">
    <meta charset="UTF-8">

    <link href='http://fonts.googleapis.com/css?family=Playfair+Display:400,700,400italic&subset=latin,latin-ext' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Playfair+Display+SC' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet'>

    <link rel="stylesheet" href="http://steveasleep.com/css/reset.css" />
    <link rel="stylesheet" href="http://steveasleep.com/css/pygments.css" />
    <link rel="stylesheet" href="http://steveasleep.com/css/style.css" />

    <!--
    <meta charset="utf-8" />
      <link href="http://steveasleep.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Steve Johnson Full Atom Feed" />
      <link href="http://steveasleep.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Steve Johnson Full RSS Feed" />
      <link href="http://steveasleep.com/feeds/articles.atom.xml" type="application/atom+xml" rel="alternate" title="Steve Johnson Categories Atom Feed" />
    -->

    <script src="http://steveasleep.com/js/hyphenate.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://steveasleep.com/js/main.js"></script>

</head>

<body>
  <header id="banner" class="body">
    <h1>
      <a href="http://steveasleep.com">
        <!--Steve Johnson <strong></strong>-->
        <!--Steve Johnson&rsquo;s<br>partial creative output-->
        Steve Johnson #6,059
      </a>
    </h1>
  </header>

  <div id="layoutcontainer">
    <div id="pagecontainer">
      <nav id="menu">
        <ul>
            <li><a href="http://steveasleep.com/">Blog</a></li>
            <li><a href="http://steveasleep.com/pyglettutorial.html">Pyglet tutorial</a></li>
            <li><a href="http://steveasleep.com/resume.html">Résumé</a></li>
            <li><a href="http://steveasleep.com/game-jam-cv.html">Game jam CV</a></li>
            <li><a href="http://sendimals.com">Sendimals</a></li>
            <li><a href="https://ldjam.com/events/ludum-dare/38/rogue-basement">Rogue Basement</a></li>
            <li><a href="http://literallycanvas.com/">Literally Canvas</a></li>
            <li><a href="http://steveasleep.com/computerwords">Computer Words</a></li>
            <li><a href="http://mrjob.readthedocs.org/">mrjob</a></li>
            <li><a href="http://hipmunk.github.io">Hipmunk OSS</a></li>
            <li><a href="http://steveasleep.com/games.html">Old games</a></li>
            <li><a href="http://thenestmusic.com">The Nest</a></li>
            <li><a href="http://slamjamsen.com">Slam Jamsen</a></li>
            <li><a href="https://github.com/irskep">GitHub</a></li>
            <li><a href="https://twitter.com/irskep">Twitter</a></li>
            <li><a href="https://www.last.fm/user/irskep">last.fm</a></li>
            <li><a href="mailto:randos@steve.steveasleep.com">Email</a></li>
        </ul>
      </nav>

  <section id="content" class="body"><article class="article">
      <header class="article-header">
    <h1 class="entry-title">
      <a href="http://steveasleep.com/pcg32-the-perfect-prng-for-roguelikes.html" rel="bookmark" title="Permalink to PCG32: The Perfect PRNG for Roguelikes">
        PCG32: The Perfect PRNG for Roguelikes
      </a>
    </h1>
    <div class="post-info">
        <time class="published" datetime="2018-03-14T00:00:00-07:00">
          14 Mar 2018
        </time>
    </div>
  </header>

    <div class="entry-content hyphenate"><p>Roguelikes are games that, among other things, have a lot of procedurally
generated content. To generate content, we need random numbers. And to get
random numbers, we need a <strong>pseudo-random number generator</strong>.</p>
<p>Not only do we want random numbers, but we want <em>predictable</em> random numbers!
We want players to be able to share seeds and see who does better in the same
situation, while also giving people a completely fresh experience every time
they play.</p>
<p>But we can't just create a PRNG with a seed and be done. If we use the same
PRNG for both level generation and combat, for example, then our second level
might change based on how many times the player got into a fight!</p>
<p>So we need to be clever about how we create and store our PRNGs, to ensure
that the procedurally generated maps are not affected by anything that happens
during gameplay.</p>
<p>But if we use the <a href="http://www.pcg-random.org">PCG family of PRNGs</a>, our job
is a lot easier. There are many variants of PCG, but in this post I'll be
referring only to PCG32, the one that generates 32-bit unsigned integers and
keeps its state as two 64-bit unsigned integers.</p>
<p>(By the way, I used PCG in
<a href="https://irskep.itch.io/dr-hallervorden">Dr. Hallervorden</a>, my 7DRL entry for 2018.
Check it out!)</p>
<h1 id="what-makes-pcg-unique">What makes PCG unique?</h1>
<p>PCG has a lot going for it, and <a href="http://www.pcg-random.org">the web site does a good job of explaining
the advantages</a>, but for roguelike developers, it
all comes down to the API.</p>
<p>A PCG instance is created with not one, but <strong>two</strong> values: the <em>seed</em>, and the
<em>stream</em>. The seed matches the traditional idea of a PRNG seed, but the stream
is something new: it lets you pick from <strong>multiple streams of random numbers</strong>
generated by the same seed!</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">UInt64</span> <span class="k">in</span> <span class="p">[</span><span class="mi">12345</span><span class="p">,</span> <span class="mi">67890</span><span class="p">]</span> <span class="p">{</span>
  <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Seed:&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">seq</span><span class="p">:</span> <span class="nb">UInt64</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span>

    <span class="c1">// two numbers: seed and seq</span>
    <span class="kd">let</span> <span class="nv">rng</span> <span class="p">=</span> <span class="n">PCG32Generator</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="n">seed</span><span class="p">,</span> <span class="n">seq</span><span class="p">:</span> <span class="n">seq</span><span class="p">)</span>

    <span class="kd">let</span> <span class="nv">values</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">].</span><span class="bp">map</span><span class="p">({</span><span class="kc">_</span> <span class="k">in</span> <span class="s">&quot;</span><span class="si">\(</span><span class="n">rng</span><span class="p">.</span><span class="kr">get</span><span class="si">(</span><span class="n">upperBound</span><span class="p">:</span> <span class="mi">100</span><span class="si">))</span><span class="s">&quot;</span> <span class="p">})</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Stream </span><span class="si">\(</span><span class="n">seq</span><span class="si">)</span><span class="s">:&quot;</span><span class="p">,</span> <span class="n">values</span><span class="p">.</span><span class="n">joined</span><span class="p">(</span><span class="n">separator</span><span class="p">:</span> <span class="s">&quot;, &quot;</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="bp">print</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Seed</span><span class="o">:</span> <span class="mi">12345</span>
<span class="n">Stream</span> <span class="mi">0</span><span class="o">:</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">26</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mi">74</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">82</span><span class="o">,</span> <span class="mi">86</span><span class="o">,</span> <span class="mi">75</span><span class="o">,</span> <span class="mi">82</span><span class="o">,</span> <span class="mi">92</span>
<span class="n">Stream</span> <span class="mi">1</span><span class="o">:</span> <span class="mi">24</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">76</span><span class="o">,</span> <span class="mi">54</span><span class="o">,</span> <span class="mi">90</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span> <span class="mi">98</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">34</span>
<span class="n">Stream</span> <span class="mi">2</span><span class="o">:</span> <span class="mi">60</span><span class="o">,</span> <span class="mi">17</span><span class="o">,</span> <span class="mi">46</span><span class="o">,</span> <span class="mi">15</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">68</span><span class="o">,</span> <span class="mi">29</span><span class="o">,</span> <span class="mi">91</span>

<span class="n">Seed</span><span class="o">:</span> <span class="mi">67890</span>
<span class="n">Stream</span> <span class="mi">0</span><span class="o">:</span> <span class="mi">54</span><span class="o">,</span> <span class="mi">68</span><span class="o">,</span> <span class="mi">74</span><span class="o">,</span> <span class="mi">56</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">63</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span> <span class="mi">47</span><span class="o">,</span> <span class="mi">21</span><span class="o">,</span> <span class="mi">96</span>
<span class="n">Stream</span> <span class="mi">1</span><span class="o">:</span> <span class="mi">36</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">80</span><span class="o">,</span> <span class="mi">58</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span> <span class="mi">31</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mi">29</span><span class="o">,</span> <span class="mi">73</span>
<span class="n">Stream</span> <span class="mi">2</span><span class="o">:</span> <span class="mi">89</span><span class="o">,</span> <span class="mi">61</span><span class="o">,</span> <span class="mi">71</span><span class="o">,</span> <span class="mi">58</span><span class="o">,</span> <span class="mi">85</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mi">70</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">59</span><span class="o">,</span> <span class="mi">31</span>
</pre></div>


<p>This means you can start your game with one seed, and then lazily create
individual PCG instances for each level at the time you need them, without
worrying that your PRNG state has been messed up just by playing the game.</p>
<p>And once we've created a PCG instance, we only need to store two unsigned
integers! Serialization's a snap.</p>
<h1 id="language-support">Language support</h1>
<p>PCG32 is very easy to implement, so it has broad language support, even though
the algorithm was only introduced in 2014. I wrote two implementations myself:
<a href="https://github.com/irskep/clubsandwich/blob/master/clubsandwich/pcg32.py">Python</a>
and <a href="https://github.com/irskep/RogueKit/blob/master/Sources/RogueKit/Util/PCG32.swift">Swift</a>.
But you should be able to find a good implementation for your favorite language
just by searching Google. And if you can't find one, it really isn't too hard
to do! It's just a handful of bitwise operations.</p></div>
  </article></section>
    </div>

    <nav id="sidebar">
      <ul>
          <h3>Writing</h3>
            <li><a href="http://steveasleep.com/">Blog</a></li>
            <li><a href="http://steveasleep.com/pyglettutorial.html">Pyglet tutorial</a></li>
            <li><a href="http://steveasleep.com/resume.html">Résumé</a></li>
            <li><a href="http://steveasleep.com/game-jam-cv.html">Game jam CV</a></li>
          <h3>Projects</h3>
            <li><a href="http://sendimals.com">Sendimals</a></li>
            <li><a href="https://ldjam.com/events/ludum-dare/38/rogue-basement">Rogue Basement</a></li>
            <li><a href="http://literallycanvas.com/">Literally Canvas</a></li>
            <li><a href="http://steveasleep.com/computerwords">Computer Words</a></li>
            <li><a href="http://mrjob.readthedocs.org/">mrjob</a></li>
            <li><a href="http://hipmunk.github.io">Hipmunk OSS</a></li>
            <li><a href="http://steveasleep.com/games.html">Old games</a></li>
          <h3>Music</h3>
            <li><a href="http://thenestmusic.com">The Nest</a></li>
            <li><a href="http://slamjamsen.com">Slam Jamsen</a></li>
          <h3>External</h3>
            <li><a href="https://github.com/irskep">GitHub</a></li>
            <li><a href="https://twitter.com/irskep">Twitter</a></li>
            <li><a href="https://www.last.fm/user/irskep">last.fm</a></li>
            <li><a href="mailto:randos@steve.steveasleep.com">Email</a></li>
      </ul>
    </nav>

  </div>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4517625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>