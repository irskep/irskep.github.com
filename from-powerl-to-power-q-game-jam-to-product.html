<!DOCTYPE html>
<html lang="en">
<head>
    <title>Steve Johnson – From PoweRL to Power-Q: game jam to&nbsp;product</title>

    <meta name="viewport" content="width=device-width">
    <meta charset="UTF-8">

    <link href='http://fonts.googleapis.com/css?family=Playfair+Display:400,700,400italic&subset=latin,latin-ext' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Playfair+Display+SC' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet'>

    <link rel="stylesheet" href="http://steveasleep.com/css/reset.css" />
    <link rel="stylesheet" href="http://steveasleep.com/css/pygments.css" />
    <link rel="stylesheet" href="http://steveasleep.com/css/style.css" />

    <!--
    <meta charset="utf-8" />
      <link href="http://steveasleep.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Steve Johnson Full Atom Feed" />
      <link href="http://steveasleep.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Steve Johnson Full RSS Feed" />
      <link href="http://steveasleep.com/feeds/articles.atom.xml" type="application/atom+xml" rel="alternate" title="Steve Johnson Categories Atom Feed" />
    -->

    <script src="http://steveasleep.com/js/hyphenate.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://steveasleep.com/js/main.js"></script>

</head>

<body>
  <header id="banner" class="body">
    <h1>
      <a href="http://steveasleep.com">
        <!--Steve Johnson <strong></strong>-->
        <!--Steve Johnson&rsquo;s<br>partial creative output-->
        Steve Johnson #6,059
      </a>
    </h1>
  </header>

  <div id="layoutcontainer">
    <div id="pagecontainer">
      <nav id="menu">
        <ul>
            <li><a href="http://steveasleep.com/">Blog</a></li>
            <li><a href="http://steveasleep.com/pyglettutorial.html">Pyglet tutorial</a></li>
            <li><a href="http://steveasleep.com/resume.html">Résumé</a></li>
            <li><a href="http://steveasleep.com/game-jam-cv.html">Game jam CV</a></li>
            <li><a href="http://sendimals.com">Sendimals</a></li>
            <li><a href="https://ldjam.com/events/ludum-dare/38/rogue-basement">Rogue Basement</a></li>
            <li><a href="http://literallycanvas.com/">Literally Canvas</a></li>
            <li><a href="http://steveasleep.com/computerwords">Computer Words</a></li>
            <li><a href="http://mrjob.readthedocs.org/">mrjob</a></li>
            <li><a href="http://hipmunk.github.io">Hipmunk OSS</a></li>
            <li><a href="http://steveasleep.com/games.html">Old games</a></li>
            <li><a href="http://thenestmusic.com">The Nest</a></li>
            <li><a href="http://slamjamsen.com">Slam Jamsen</a></li>
            <li><a href="https://github.com/irskep">GitHub</a></li>
            <li><a href="https://twitter.com/irskep">Twitter</a></li>
            <li><a href="https://www.last.fm/user/irskep">last.fm</a></li>
            <li><a href="mailto:randos@steve.steveasleep.com">Email</a></li>
        </ul>
      </nav>

  <section id="content" class="body"><article class="article">
      <header class="article-header">
    <h1 class="entry-title">
      <a href="http://steveasleep.com/from-powerl-to-power-q-game-jam-to-product.html" rel="bookmark" title="Permalink to From PoweRL to Power-Q: game jam to product">
        From PoweRL to Power-Q: game jam to&nbsp;product
      </a>
    </h1>
    <div class="post-info">
        <time class="published" datetime="2017-09-03T00:00:00-07:00">
          03 Sep 2017
        </time>
    </div>
  </header>

    <div class="entry-content hyphenate"><p><a href="https://irskep.itch.io/powerq">Power-Q</a> is the polished, productized version of my Ludum Dare game <a href="https://irskep.itch.io/powerl">PoweRL</a>. They have exactly the same mechanics, but Power-Q has about 30 extra hours of effort invested into it. Before I send it out into the world, I want to reflect upon where those 30 hours&nbsp;went.</p>
<p>Power-Q is in beta on Mac and iOS. You can get the Mac beta <a href="https://irskep.itch.io/powerl">on itch.io</a>, but to get the iOS beta you’ll have to <a href="powerq@steve.steveasleep.com">email&nbsp;me.</a></p>
<p><img alt="screenshot" src="http://steveasleep.com/img/powerq/screenshot.png" /></p>
<p>Before:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UwGfKSDzyeY?rel=0" frameborder="0" allowfullscreen></iframe>

<p>After:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/5ggZDCYNHyg?rel=0" frameborder="0" allowfullscreen></iframe>

<h2 id="game-mechanics">Game&nbsp;mechanics</h2>
<p>Power-Q is a turn-based game played on an 8-column, 6-row grid. The player is a robot with a health bar and a power meter. They can move up, down, left, or right. Each move drains&nbsp;power.</p>
<p>The level contains walls, enemies, powerups, and an exit. The overall goal of the game is to reach the exit 8 times. Each level has more enemies than the last. Powerups include health boosts, power boosts, and&nbsp;ammunition.</p>
<p>There are three kinds of enemies. They move in specific patterns (diagonals, up/down/left/right every other turn, and knight-style) and sap your health when they hit you. There are also “power drains,” which sap your power and disappear if you run over&nbsp;them.</p>
<p><img alt="moves diagram" src="http://steveasleep.com/img/powerq/moves.png" /></p>
<p>The player has a melee attack and a ranged attack. The melee attack can kill a health-draining enemy in two hits. The ranged attack consumes ammunition and can kill an enemy in one&nbsp;hit.</p>
<p>Although I only published the Mac version for Ludum Dare, I wanted to make sure the interface could work on an iPhone. There are only two kinds of interactions you can have with the game: you can move (arrow keys on Mac, swipe on iOS) and shoot (click on Mac, double-tap on&nbsp;iOS).</p>
<p>That’s it, the end! That’s the whole game. Each game is supposed to last about five minutes. I could expand the enemy roster, but I wanted to limit the scope to something I could finish on weekends before my intrinsic motivation ran&nbsp;out.</p>
<h3 id="polishing-the-mechanics">Polishing the&nbsp;mechanics</h3>
<p>I was pretty happy with the mechanics in the context of a short game, but I wanted to solve a few problems before sending it out to the&nbsp;masses.</p>
<h4 id="unreachable-exits-and-powerups">Unreachable exits and&nbsp;powerups</h4>
<p>One of the most common bits of negative feedback from Ludum Dare raters, besides crashes, was that the exit was sometimes unreachable or too close to the player to be a&nbsp;challenge.</p>
<p>I could have solved this by writing a smarter level generator, but I liked the general character of the levels I was getting already, so I just added a flood fill-style reachability check and had the game re-roll the level if it was no good. Exit placement was solved by putting it as far away from the player as possible instead of any old&nbsp;place.</p>
<p>If you look at the console logs, you’ll see that every level is re-rolled 1-4 times on average, but it’s really fast, so it won’t matter to&nbsp;players.</p>
<h4 id="frustrating-targeting">Frustrating&nbsp;targeting</h4>
<p>Shooting follows a line determined by <a href="https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm">Bresenham&#8217;s algorithm</a>. It means a bullet path follows the yellow&nbsp;squares:</p>
<p><img alt="bresenham exmaple" src="http://steveasleep.com/img/powerq/bresenham_1.png" /></p>
<p>The algorithm is popular and well understood. It&#8217;s convenient for a programmer, but can be frustrating for players if used for this kind of thing&nbsp;naïvely.</p>
<p>As an example, take a look at this&nbsp;situation:</p>
<p><img alt="bresenham exmaple" src="http://steveasleep.com/img/powerq/bresenham_2.png" /></p>
<p>Given the way shooting works, the player could reasonably expect to shoot around the corner. And it would&nbsp;work:</p>
<p><img alt="bresenham exmaple" src="http://steveasleep.com/img/powerq/bresenham_3.png" /></p>
<p>But what if the middle two cells were flipped? The player probably expects to be able to shoot the&nbsp;enemy.</p>
<p><img alt="bresenham exmaple" src="http://steveasleep.com/img/powerq/bresenham_4.png" /></p>
<p>Oh no! That&#8217;s a terrible experience! it will fail and the player won&#8217;t know&nbsp;why.</p>
<p>I solved this problem by exploiting the asymmetry of Bresenham&#8217;s line algorithm. If you run it from point A to point B, you get a different set of points than if you run it from point B to point A! By running it both ways every time, almost all of these weird cases are covered because the reverse version uses a slightly different path from the regular&nbsp;version.</p>
<h4 id="smarter-enemies">Smarter&nbsp;enemies</h4>
<p>The <span class="caps">AI</span> in this game is really dumb. The diagonal- and knight-moving enemies don&#8217;t do any pathfinding. They just move to whatever cell is closest to&nbsp;them.</p>
<p>The dumb <span class="caps">AI</span> is mostly fine, but for the &#8220;turtle&#8221; (originally an actual turtle, now a kind of blobby thing), which moves one cell up/down/left/right every other turn, it was too much of a limitation. So I added pathfinding just to the turtle. It will move toward the player even if it has to go around some walls, instead of getting stuck in corners like an&nbsp;idiot.</p>
<h4 id="scoring">Scoring</h4>
<p>Typical players will die a lot before beating the game, and I don&#8217;t want them to feel like they aren&#8217;t progressing. A simple high score counter seemed like a good solution. I made each enemy worth one point and displayed the highest score on the title&nbsp;screen.</p>
<h2 id="art">Art</h2>
<p>I developed the game using <span class="caps">ASCII</span> characters for most of Ludum Dare. Midway through, I turned the enemies into emoji. As the deadline approached, it didn’t feel right to use Apple’s beautiful high-resolution animal illustrations as my game art, so I did some bad tracings in Pixelmator and shipped&nbsp;it.</p>
<p><img alt="screenshot from jam" src="http://steveasleep.com/img/powerq/screenshot_before.png" /></p>
<p>I immediately regretted all of my art choices. The whole thing looked like crap to me. So I downloaded <a href="https://piskelapp.com">Piskel</a> and started on some 16x16 pixel art style sprites. The result was a lot more charming! I packaged it up into a post-compo build with some crash fixes a couple days after the jam&nbsp;ended.</p>
<p><img alt="screenshot from just after the" src="http://steveasleep.com/img/powerq/screenshot_before_2.png" /></p>
<h3 id="polishing-the-art">Polishing the&nbsp;art</h3>
<p>As I converted more of my art to the new style, I became frustrated with Piskel’s <span class="caps">UI</span>. I bought <a href="https://www.aseprite.org">Aseprite</a> instead and my pixel art productivity skyrocketed. I reduced my color palette and put the finishing touches on the sprites. As someone without any art training, I found creating the color palette to be a bigger challenge than I would have expected, though I suspect if I had started with Aseprite instead of Piskel I would have been more consistent from the beginning and had an easier time of&nbsp;it.</p>
<p>My game-over screens were just black voids with text in the middle of them, so as soon as I was done with the sprites, I did some simple illustrations for the three possible endgame conditions: a win, a loss due to power, and a loss due to&nbsp;health.</p>
<p>One enemy, formerly known as the turtle, moves every other turn. It was impossible to know at a glance whether it was about to move or not. I replaced the single turtle frame with a blobby thing that flips between two&nbsp;frames.</p>
<p>I’m leaving a lot out here. There were probably a hundred more little things I did to the&nbsp;art.</p>
<p><img alt="screenshot from final game" src="http://steveasleep.com/img/powerq/screenshot.png" /></p>
<h2 id="music-and-sound">Music and&nbsp;sound</h2>
<p>Music production for 48-hour game jams requires a careful balance between time spent and dopeness. My initial music pass had a pretty good set of sounds and melodies, but I rearranged it a little bit for the final release. I might still write a second&nbsp;track.</p>
<p>To get an extra push over the musical polish line, I put <a href="https://gooseninja.itch.io/space-music-pack">GooseNinja’s space-themed loading track</a> over the title screen. If this game makes any money, I’ll be kicking some of it over to&nbsp;them.</p>
<p>My approach to sound was to open Logic Pro X and bonk around on presets until it sounded video gamey. It worked great! I didn’t change much on the sound front, but the ranged attack sound was a little clipped and unimpressive. I replaced it with two sounds: one for the player firing and one for the impact of the bullet. The firing sound is a drum machine hi hat and the impact is a kick&nbsp;drum.</p>
<p>I added graphical toggles for sound and music, because smartphone users are often listening to podcasts or music while they play games. I made sure the game wouldn’t interrupt any already-playing&nbsp;audio.</p>
<p>My Ludum Dare score for audio was a lot lower than I thought it would be, so I worry that I haven’t done enough for the audio of this game. My last game, <a href="https://irskep.itch.io/roguebasement">Rogue Basement</a>, scored much higher and didn’t even have sound effects! What it did have, though, was four tracks of music and cool location-based transitions between them. Power-Q doesn’t have the same sense of space, and I’m not sure I’ll be able to make the music as distinctive as it was in Rogue Basement no matter what I do, so I’m not worrying about it for&nbsp;now.</p>
<h2 id="help-screen">Help&nbsp;screen</h2>
<p>For the Ludum Dare build, I did what most people do: slap some instruction text on the title screen. For the final version, I moved the instructions to a separate&nbsp;screen.</p>
<p>Before:</p>
<p><img alt="help screen before" src="http://steveasleep.com/img/powerq/help_screen_before.png" /></p>
<p>After:</p>
<p><img alt="help screen after" src="http://steveasleep.com/img/powerq/help_screen.png" /></p>
<h2 id="portrait-mode">Portrait&nbsp;mode</h2>
<p>One of my core beliefs as an iOS gamer and developer is one that apparently isn’t shared by game developers who make otherwise great&nbsp;games:</p>
<p><strong>If your iOS game can be played with one hand, it should support portrait&nbsp;mode.</strong></p>
<p>I can’t believe I even have to bring this up, but for frack’s sake, 868-<span class="caps">HACK</span> can only be played in landscape mode! I’ve developed a comfortable but absurd grip that lets me see the screen and move, but there is absolutely no reason why that game could not let you rotate that little glass rectangle 90 degrees and keep all the text&nbsp;readable.</p>
<p>Given my passion for this belief, as soon as Ludum Dare was over, I began to think about how I’d go about supporting portrait mode in&nbsp;Power-Q.</p>
<p>In terms of just the interface, the solution was simple. The 8x6 grid was designed to comfortably fit on an iPhone 5S without scrolling, so in portrait mode, it would just become a 6x8 grid! The map would physically stay in the same place in both rotations; only your perspective of the objects would change. The resource bars and labels would be at the bottom of the screen instead of the&nbsp;left.</p>
<p>In practice, this feels a bit weird when you see the rotation in person, but when you’re playing locked in one rotation it doesn’t matter at all and just&nbsp;works.</p>
<p><img alt="help screen after" src="http://steveasleep.com/img/powerq/portrait.png" /></p>
<p>But in the code, it was nightmarish. I had to move a lot of layout code around and make sure every sprite was in the right place at all times. And because the map was just rotated 90º, I also had to un-rotate all the sprites individually and do a little bit of funky coordinate space translation math to detect grid touches correctly. Now every single screen in the game has two completely separate layouts that have to be individually&nbsp;tested.</p>
<p>So I guess I lied when I said there was “no reason” why 868-<span class="caps">HACK</span> couldn’t support portrait mode. It would be a lot of work. But I swear on Steve Job’s grave that I would pay $10 for an in-app purchase that enables&nbsp;it.</p>
<p>Now that I’ve baked the portrait/landscape duality into the game, I think I’ll just do it for every iOS game I make going forward. The patterns are easy to understand and implement. In the future, though, I’m going to just make games with scrolling or square maps so I don’t have to rotate the playing&nbsp;field.</p>
<h2 id="saving-and-loading">Saving and&nbsp;loading</h2>
<p>Power-Q is a simple game without an explicit save system, but on iOS it’s important not to lose the player’s game when the app is kicked out of <span class="caps">RAM</span>.</p>
<p>That means my hacky, often thoughtless Ludum Dare code had to be refactored <em>a lot</em>. The main issue was that the map generator gave you a fully connected object graph with lots of references between objects, instead of a flat data structure that was easy to&nbsp;serialize. </p>
<p>There was no shortcut, so I just dove in. It took about 500 lines of new code, but it worked the very first time I ran it. (I have a lot of practice writing serialization code from working on <a href="https://itunes.apple.com/us/app/hipmunk-travel-hotels-flights/id419950680">Hipmunk</a>!)</p>
<p>PowerRL/Power-Q uses an <a href="https://developer.apple.com/library/content/documentation/General/Conceptual/GameplayKit_Guide/EntityComponent.html#//apple_ref/doc/uid/TP40015172-CH6-SW1">entity-component system</a>. The main change I made was to add serialization code to every component possible. I also introduced new components whose only job is to hold information used to reconstruct more complex components when the game is loaded from a&nbsp;file.</p>
<p><a href="https://gist.github.com/irskep/624d8edb0007e796d6ba0fdd2a5cb9ea">Here’s what the save file looks like.</a> It’s written at the beginning of each level and loaded when the app&nbsp;launches.</p>
<h2 id="takeaways">Takeaways</h2>
<p>Swift, SpriteKit, and GameplayKit are really, really good for rapid prototyping and general 2D game development. I’ll never produce a Windows or Android port, but having fun is more important to&nbsp;me.</p>
<p>Good-looking pixel art is much easier for me to create than vector art. I’ll just start with that style in future game&nbsp;jams.</p>
<p>It helps to think about saving and loading from the beginning, to avoid working with bad assumptions about how scene construction and map creation should&nbsp;work.</p>
<p>Re-rolling bad procedurally generated levels is much simpler than writing fancy algorithms to make them good in the first place, as long as it’s cheap to do&nbsp;so.</p>
<h2 id="full-changelog">Full&nbsp;changelog</h2>
<ul>
<li>Completely new art in every&nbsp;screen</li>
<li>Portrait mode supported on&nbsp;phones</li>
<li><span class="caps">UI</span> layout tweaks in every&nbsp;screen</li>
<li>Help&nbsp;screen</li>
<li>No levels with unreachable exits or&nbsp;powerups</li>
<li>Music is slightly&nbsp;better</li>
<li>Different sounds for&nbsp;shooting</li>
<li>Game saves at the start of each level, loads on&nbsp;launch</li>
</ul></div>
  </article></section>
    </div>

    <nav id="sidebar">
      <ul>
          <h3>Writing</h3>
            <li><a href="http://steveasleep.com/">Blog</a></li>
            <li><a href="http://steveasleep.com/pyglettutorial.html">Pyglet tutorial</a></li>
            <li><a href="http://steveasleep.com/resume.html">Résumé</a></li>
            <li><a href="http://steveasleep.com/game-jam-cv.html">Game jam CV</a></li>
          <h3>Projects</h3>
            <li><a href="http://sendimals.com">Sendimals</a></li>
            <li><a href="https://ldjam.com/events/ludum-dare/38/rogue-basement">Rogue Basement</a></li>
            <li><a href="http://literallycanvas.com/">Literally Canvas</a></li>
            <li><a href="http://steveasleep.com/computerwords">Computer Words</a></li>
            <li><a href="http://mrjob.readthedocs.org/">mrjob</a></li>
            <li><a href="http://hipmunk.github.io">Hipmunk OSS</a></li>
            <li><a href="http://steveasleep.com/games.html">Old games</a></li>
          <h3>Music</h3>
            <li><a href="http://thenestmusic.com">The Nest</a></li>
            <li><a href="http://slamjamsen.com">Slam Jamsen</a></li>
          <h3>External</h3>
            <li><a href="https://github.com/irskep">GitHub</a></li>
            <li><a href="https://twitter.com/irskep">Twitter</a></li>
            <li><a href="https://www.last.fm/user/irskep">last.fm</a></li>
            <li><a href="mailto:randos@steve.steveasleep.com">Email</a></li>
      </ul>
    </nav>

  </div>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4517625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>