<!DOCTYPE html>
<html lang="en">
<head>
    <title>Steve Landey – How I use git</title>

    <meta name="viewport" content="width=device-width">
    <meta charset="UTF-8">


    <link rel="stylesheet" href="http://steveasleep.com/css/style.css" />

    <meta charset="utf-8" />
      <link href="http://steveasleep.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Steve Landey Full Atom Feed" />
      <link href="http://steveasleep.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Steve Landey Full RSS Feed" />
    <!--
      <link href="http://steveasleep.com/feeds/articles.atom.xml" type="application/atom+xml" rel="alternate" title="Steve Landey Categories Atom Feed" />
    -->

    <script src="http://steveasleep.com/js/hyphenate.js" defer></script>
    <script src="http://steveasleep.com/js/main.js" defer></script>

</head>

<body>
  <div id="layoutcontainer">
    <div id="pagecontainer">
      <header id="banner" class="body">
        <h1>
          <a href="http://steveasleep.com">
            <!--Steve Landey <strong></strong>-->
            <!--Steve Johnson&rsquo;s<br>partial creative output-->
            Steve Landey
          </a>
        </h1>
        <div class="header-links">
            <a href="mailto:randos@steve.steveasleep.com">Email</a>
            <a href="https://github.com/irskep">GitHub</a>
            <a href="https://www.youtube.com/channel/UC0lx9IhbHiM5XTcdISqttWQ">YouTube</a>
            <a href="https://slamjamsen.bandcamp.com">Bandcamp</a>
            <a href="https://irskep.itch.io">itch.io</a>
        </div>
      </header>
      <!--
      <nav id="menu">
        <ul>
          <li><strong>Writing:</strong>
              <a href="https://blog.steveasleep.com/">Blog</a>
              <a href="https://twitter.com/irskep">Twitter</a>
              <a href="http://steveasleep.com/articles/">Old blog</a>
              <a href="http://steveasleep.com/resume.html">Résumé</a>
          </li>
          <li><strong>Games:</strong>
              <a href="https://irskep.itch.io/dr-hallervorden">Dr. Hallervorden</a>
              <a href="https://irskep.itch.io/powerq">Power-Q</a>
              <a href="https://irskep.itch.io/roguebasement">Rogue Basement</a>
              <a href="http://steveasleep.com/games.html">17 more games</a>
          </li>
          <li><strong>Apps:</strong>
              <a href="http://sendimals.com">Sendimals</a>
              <a href="https://itunes.apple.com/us/app/hipmunk-travel-search/id419950680?mt=8">Hipmunk</a>
              <a href="https://itunes.apple.com/us/app/asana-organize-tasks-work/id489969512?mt=8">Asana</a>
          </li>
          <li><strong>Open Source:</strong>
              <a href="https://asana.github.io/Drawsana/">Drawsana</a>
              <a href="http://literallycanvas.com/">Literally Canvas</a>
              <a href="http://steveasleep.com/clubsandwich">clubsandwich</a>
              <a href="http://steveasleep.com/BearLibTerminal-Swift/">BearLibTerminal-Swift</a>
              <a href="http://steveasleep.com/jumbogrove">Jumbo Grove</a>
              <a href="https://sphinx-better-theme.readthedocs.io/en/latest/">sphinx-better-theme</a>
          </li>
        </ul>
      </nav>
      -->

  <section id="content" class="body"><article class="article">
      <header class="article-header">
    <h1 class="entry-title">
      <a href="http://steveasleep.com/drafts/how-i-use-git.html" rel="bookmark" title="Permalink to How I use git">
        How I use git
      </a>
    </h1>
    <div class="post-info">
        <time class="published" datetime="2017-11-17T00:00:00-08:00">
          November 17, 2017
        </time>
    </div>
  </header>

    <div class="entry-content hyphenate"><p>When you use a tool for a long time, it can be easy to forget what it was like
to learn it for the first time. It becomes routine. As someone who passed this
point with git long ago, I thought it might be helpful to share my day-to-day
workflow in case someone wandering around the internet finds it helpful.</p>
<h1>Vocabulary</h1>
<p>To understand this post you need to know what these words mean in the git
universe:</p>
<ul>
<li>Staging area</li>
<li>Commit</li>
<li>Amend</li>
<li>Rebase</li>
<li>Clone</li>
<li>Branch</li>
<li>Checkout</li>
</ul>
<h1>My employer's git workflow</h1>
<p>I work at Hipmunk. We use a rebase-and-squash workflow. This means that when
a pull request has been reviewed, the tests pass, and it's ready to go
"into production," all the commits from the branch are combined into one and
added as a single commit on the master branch, with the pull request
description as the commit message.</p>
<p>So this:</p>
<div class="highlight"><pre><span></span>master:         [a]---&gt;[b]---&gt;[c]---&gt;[d]
                   \
feature branch:     \-&gt;[e]---&gt;[f]
</pre></div>


<p>Becomes this:</p>
<div class="highlight"><pre><span></span>master:         [a]---&gt;[b]---&gt;[c]---&gt;[d]---&gt;[ef]
</pre></div>


<p>Most people use merges instead:</p>
<div class="highlight"><pre><span></span>master:         [a]---&gt;[b]---&gt;[c]---&gt;[d]--&gt;[g]
                   \                     /
feature branch:     \-&gt;[e]---&gt;[f]-------/
</pre></div>


<p>But we don't.</p>
<h1>Git remote setup</h1>
<p>There are three git clones I care about:</p>
<ul>
<li>The canonical one at <code>github.com/Hipmunk/blah</code>. This is <code>upstream</code>.</li>
<li>My GitHub clone at <code>github.com/irskep/blah</code>. This is <code>origin</code>.</li>
<li>My local clone.</li>
</ul>
<h1>Starting work on a new feature</h1>
<p>The very first thing I do every time is <code>git fetch upstream</code>, to make sure I
make my new branch from the latest <code>master</code>. Then I
<code>git clone upstream/master -b BRANCH_NAME</code>.</p>
<p>For features, I name my branches like <code>pr/feature-name</code>. The <code>pr/</code> prefix
means this branch is meant to eventually be a pull request on GitHub, as
opposed to a scratchpad, merge of some unfinished demo code, or release branch.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span>git fetch upstream <span class="o">&amp;&amp;</span> git clone upstream/master -b pr/fix-the-bug
<span class="c1"># I actually have that command aliased to &quot;gbn&quot;, so in reality I type:</span>
<span class="c1"># gbn pr/fix-the-bug</span>
</pre></div>


<h2>Git command recap</h2>
<ul>
<li><code>git fetch upstream</code> to make sure local clone of <code>upstream</code> is up to date</li>
<li><code>git checkout upstream/master -b BRANCH</code> creates a new branch starting from
  the <code>HEAD</code> of the <code>master</code> branch of the local <code>upstream</code> clone</li>
</ul>
<h1>Working on the feature</h1>
<p>I commit frequently, and I amend my commits frequently. My rules for committing
are:</p>
<ul>
<li>Always read the entire diff before staging. This means either running
  <code>git diff</code> before <code>git add .</code>, or staging with <code>git add -p .</code> to get only
  the changes I want.</li>
<li>If code is for testing or debugging only, commit it without any other
  changes in the same commit. When I no longer need it, revert the commit.</li>
<li>If I have written out a complete idea, and the code compiles, commit without
  executing it. Try to give commits descriptive names that define what should
  and should not be in the commit.</li>
<li>If I run the code and it doesn't work, and I then fix the bug, then either
  amend the commit that introduced the bug immediately, or create a commit that
  refers to the buggy commit in its description.</li>
<li>Commits containing unit tests should only contain the new tests, or fixes for
  bugs found by those tests. I don't have a good reason for doing this, it's
  just what I do most often.</li>
<li>Code review feedback is in bite-sized pieces at the end.</li>
</ul>
<p>When I feel like I'm ready to step back and either do somethinking or open a
pull request, I run <code>git rebase -i upstream/dev</code> to fix any issues with my
commit history.</p>
<p>Here's an example workflow:</p>
<div class="highlight"><pre><span></span><span class="c1"># gbn = git fetch upstream &amp;&amp; git checkout -b upstream/master $1</span>
gbn pr/account-settings-loading-state
<span class="c1"># ... work ...</span>
git add -p .  <span class="c1"># stage everything relevant. I alias this to `gap`.</span>
git commit -m <span class="s2">&quot;Add loading state to account settings screen&quot;</span>
<span class="c1"># ... run, find bug ...</span>
git add -p .  <span class="c1"># stage the bug fix</span>
<span class="c1"># this amends the most recent commit without prompting to change</span>
<span class="c1"># the message:</span>
git commit --amend -CHEAD <span class="c1"># I alias this to `gcaa`.</span>
<span class="c1"># ... write tests ...</span>
git commit -am <span class="s2">&quot;Write tests&quot;</span>  <span class="c1"># I admit this is what I really write.</span>
<span class="c1"># I alias gcam to `git commit -am` to save typing.</span>
<span class="c1"># ... run tests, find bug, fix bug</span>
git diff    <span class="c1"># check diff</span>
git add .   <span class="c1"># diff was fine, stage everything</span>
git commit -m <span class="s1">&#39;Fix initial implementation&#39;</span>
<span class="c1"># Done, tests pass! Now to fix the history:</span>
git rebase -i upstream/master
    <span class="c1"># That will open a text editor containing these lines:</span>
    pick 0abc Add loading state to account settings screen
    pick 5xyz Write tests
    pick qrs4 Fix initial implementation

    <span class="c1"># I edit it to look like this:</span>
    pick 0abc Add loading state to account settings screen
    fixup qrs4 Fix initial implementation
    pick 5xyz Write tests

    <span class="c1"># Save and quit.</span>
    <span class="c1"># Now my commit history looks like this:</span>
    e351 Add loading state to account settings screen
    facb Write tests
</pre></div>


<h2>Git command recap</h2>
<ul>
<li><code>git add -p</code> opens an interactive interface for adding lines to the staging
  area.</li>
<li><code>git commit -m</code> turns the staging area into a commit with the given message.</li>
<li><code>git commit --amend -CHEAD</code> amends the latest commit to include the changes
  in the staging area without altering the commit message.</li>
<li><code>git commit -am</code> adds all change to the staging area (except untracked files)
  and creates a new commit with the given message.</li>
<li><code>git diff</code> shows all unstaged changes (except untracked files).</li>
<li><code>git add .</code> adds all changes, including untracked files, to the staging area.</li>
<li><code>git rebase -i ANCESTOR</code> lets you interactively reorder, omit, and
  combine all commits in the current branch back to <code>ANCESTOR</code>.</li>
</ul>
<h1>Getting sidetracked</h1>
<p>If I'm working on a task but notice something else that needs to be done, I'm
not always disciplined about staying on track. If I do decided to wander out of
scope for my current branch, here's what I do:</p>
<div class="highlight"><pre><span></span><span class="c1"># starting on pr/original-branch...</span>
git add -p .  <span class="c1"># stage everything that matters to this branch</span>
git checkout -b pr/distraction
<span class="c1"># Develop pr/distraction using normal workflow</span>
git rebase -i upstream/master
    <span class="c1"># Using interactive rebase, I remove all commits from pr/original-branch,</span>
    <span class="c1"># keeping only the ones I added after creating pr/distraction.</span>
</pre></div>


<p>Now I can open a pull request containing only the changes from
<code>pr/distraction</code>, and avoid creating a huge, badly-scoped diff! And I can
<code>git checkout pr/original-branch</code> to keep working on what I was before.</p>
<h1>Keeping up to date</h1>
<p>When working quickly on a small team, it's not uncommon to need to rebase
on <code>upstream/master</code> to get the latest version of an API or fix a conflict.
The first step of this process is just <code>git rebase upstream master</code>.</p>
<p>But what if there's a conflict? Forget opening a text editor and dealing
with all those <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code> garbage lines. Instead, I do this:</p>
<div class="highlight"><pre><span></span>git mergetool -t opendiff  <span class="c1"># aliased to `gmto`</span>
</pre></div>


<p>This uses Apple's graphical diff tool. Press Command+D to scroll to the next
conflict. Use the bottom right option control to choose different resolutions,
or manually edit the bottom area yourself.</p>
<h1>Getting ahead of myself</h1>
<p>At Hipmunk, we try to keep patches small so that reviewers can do their best
work. But I'm an impatient person, so I'll often write the first half of a
feature, like the data models, open a pull request for that, and start working
on the second half, like the UI, before the first pull request has been
reviewed and committed.</p>
<p>Let's say the first pull request is for <code>pr/account-page-data-models</code>. There
are two commits:</p>
<div class="highlight"><pre><span></span><span class="n">aaa</span><span class="o">:</span> <span class="n">Account</span> <span class="n">page</span> <span class="n">data</span> <span class="n">models</span>
<span class="n">bbb</span><span class="o">:</span> <span class="n">Account</span> <span class="n">page</span> <span class="n">data</span> <span class="n">model</span> <span class="n">tests</span>
</pre></div>


<p>On a branch starting at that point, <code>pr/account-page-ui</code>, we add three commits:</p>
<div class="highlight"><pre><span></span><span class="n">ccc</span><span class="o">:</span> <span class="n">Account</span> <span class="n">page</span> <span class="n">view</span> <span class="n">controller</span>
<span class="n">ddd</span><span class="o">:</span> <span class="n">Account</span> <span class="n">page</span> <span class="n">content</span>
<span class="n">eee</span><span class="o">:</span> <span class="n">Account</span> <span class="n">page</span> <span class="n">UI</span> <span class="n">tests</span>
</pre></div>


<p>At this point, we check our email and see that <code>pr/account-page-data-models</code>
has some code review feedback we need to address. So take care of that:</p>
<div class="highlight"><pre><span></span>git checkout pr/account-page-data-models
<span class="c1"># type type type</span>
git commit -am <span class="s2">&quot;Address code review feedback&quot;</span>
</pre></div>


<p>At that point, the reviewer approves the pull request, and we commit
<code>pr/account-page-data-models</code> to <code>upstream/master</code>.</p>
<p>Now we are in a pickle, because <code>upstream/master</code> has ONE commit for the
first set of changes, but our branch <code>pr/account-page-ui</code> has TWO commits for
the same changes! If we <code>git fetch upstream &amp;&amp; git rebase upstream/master</code>,
we will almost certainly have conflicts.</p>
<div class="highlight"><pre><span></span>upstream/master:
    fff: PR #1234 Account page data models + tests
pr/account-page-ui:
    aaa: Account page data models
    bbb: Account page data model tests
    ccc: Account page view controller
    ddd: Account page content
    eee: Account page UI tests
</pre></div>


<p>I have two strategies for dealing with this situation. One is more
straightforward and has more steps. The other is more confusing and has
fewer steps.</p>
<h2>The straightforward version</h2>
<div class="highlight"><pre><span></span>git checkout pr/account-page-ui
git rebase -i aaa^  <span class="c1"># rebase starting at aaa&#39;s parent</span>
    pick aaa
    fixup bbb
    pick ccc
    pick ddd
    pick eee: Account page UI tests
</pre></div>


<p>By squashing all commits from the first pull request, we end up with a commit
whose diff is identical to the one in <code>upstream/master</code>, so a rebase no longer
reports conflicts.</p>
<h2>The confusing version</h2>
<p>When <code>git rebase upstream/master</code> reports conflicts, simply <code>git rebase --skip</code>
until it succeeds!</p>
<p>This works because conflicts will only appear on commits that ended up as part
of the combined commit.</p>
<h1>A final note about aliases</h1>
<p>Almost every command I use daily has an alias. There is no reason to keep
recalling the arcane interface of git. By using aliases, I no longer think of
these commands as "git commant plus necessary options." Instead, I think of
them as single verbs. Who the heck wants to remember "amend the latest commit
with my changes" as <code>git commit --amend -CHEAD</code>? What a pain!</p>
<p>Exceptions to the rule for me are <code>git add</code> and <code>git rebase</code>, which make sense
on their own.</p>
<ul>
<li><code>gfu</code>: <code>git fetch upstream</code></li>
<li><code>gcb</code>: <code>git checkout upstream/master -b BRANCH</code></li>
<li><code>gap</code>: <code>git add -p</code></li>
<li><code>gcm</code>: <code>git commit -m</code></li>
<li><code>gcaa</code>: <code>git commit --amend -CHEAD</code></li>
<li><code>gcam</code>: <code>git commit -am</code></li>
<li><code>gd</code>: <code>git diff</code></li>
<li><code>gbn</code>: <code>git fetch upstream &amp;&amp; gcb $1</code></li>
</ul></div>
  </article></section>
    </div>

    <!--
    <nav id="sidebar">
      <ul>
          <h3>Writing</h3>
            <li><a href="https://blog.steveasleep.com/">Blog</a></li>
            <li><a href="https://twitter.com/irskep">Twitter</a></li>
            <li><a href="http://steveasleep.com/articles/">Old blog</a></li>
            <li><a href="http://steveasleep.com/resume.html">Résumé</a></li>
          <h3>Games</h3>
            <li><a href="https://irskep.itch.io/dr-hallervorden">Dr. Hallervorden</a></li>
            <li><a href="https://irskep.itch.io/powerq">Power-Q</a></li>
            <li><a href="https://irskep.itch.io/roguebasement">Rogue Basement</a></li>
            <li><a href="http://steveasleep.com/games.html">17 more games</a></li>
          <h3>Apps</h3>
            <li><a href="http://sendimals.com">Sendimals</a></li>
            <li><a href="https://itunes.apple.com/us/app/hipmunk-travel-search/id419950680?mt=8">Hipmunk</a></li>
            <li><a href="https://itunes.apple.com/us/app/asana-organize-tasks-work/id489969512?mt=8">Asana</a></li>
          <h3>Open Source</h3>
            <li><a href="https://asana.github.io/Drawsana/">Drawsana</a></li>
            <li><a href="http://literallycanvas.com/">Literally Canvas</a></li>
            <li><a href="http://steveasleep.com/clubsandwich">clubsandwich</a></li>
            <li><a href="http://steveasleep.com/BearLibTerminal-Swift/">BearLibTerminal-Swift</a></li>
            <li><a href="http://steveasleep.com/jumbogrove">Jumbo Grove</a></li>
            <li><a href="https://sphinx-better-theme.readthedocs.io/en/latest/">sphinx-better-theme</a></li>
      </ul>
    </nav>
    -->

  </div>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4517625-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>